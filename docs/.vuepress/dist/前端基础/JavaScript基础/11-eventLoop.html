<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guangyuan&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/logo.jpg">
    <meta name="description" content="广园的个人博客">
    
    <link rel="preload" href="/assets/css/0.styles.a8c216e1.css" as="style"><link rel="preload" href="/assets/js/app.220ea92e.js" as="script"><link rel="preload" href="/assets/js/2.704b5ff1.js" as="script"><link rel="preload" href="/assets/js/13.7eef8f89.js" as="script"><link rel="prefetch" href="/assets/js/10.4fcf8b49.js"><link rel="prefetch" href="/assets/js/11.3a12e065.js"><link rel="prefetch" href="/assets/js/12.c219fff6.js"><link rel="prefetch" href="/assets/js/14.c0ab6614.js"><link rel="prefetch" href="/assets/js/15.de0aa9e7.js"><link rel="prefetch" href="/assets/js/16.4cb6a3e4.js"><link rel="prefetch" href="/assets/js/17.6d4d9a84.js"><link rel="prefetch" href="/assets/js/18.948f3068.js"><link rel="prefetch" href="/assets/js/19.f9678455.js"><link rel="prefetch" href="/assets/js/20.ce265f59.js"><link rel="prefetch" href="/assets/js/21.8dbc62ec.js"><link rel="prefetch" href="/assets/js/22.faf6978a.js"><link rel="prefetch" href="/assets/js/23.001bba3f.js"><link rel="prefetch" href="/assets/js/24.4a6fd55f.js"><link rel="prefetch" href="/assets/js/25.93490e40.js"><link rel="prefetch" href="/assets/js/26.e4a9afa0.js"><link rel="prefetch" href="/assets/js/27.8058a4cc.js"><link rel="prefetch" href="/assets/js/28.56e2c072.js"><link rel="prefetch" href="/assets/js/29.2cfe1c8c.js"><link rel="prefetch" href="/assets/js/3.2578889c.js"><link rel="prefetch" href="/assets/js/30.25f71f40.js"><link rel="prefetch" href="/assets/js/31.ec750104.js"><link rel="prefetch" href="/assets/js/32.ec8048a6.js"><link rel="prefetch" href="/assets/js/33.68ae4c08.js"><link rel="prefetch" href="/assets/js/34.30851da1.js"><link rel="prefetch" href="/assets/js/35.d6ea2477.js"><link rel="prefetch" href="/assets/js/36.2e4d342d.js"><link rel="prefetch" href="/assets/js/37.c4346aae.js"><link rel="prefetch" href="/assets/js/38.68dd7a97.js"><link rel="prefetch" href="/assets/js/39.b615dfdf.js"><link rel="prefetch" href="/assets/js/4.15db01ee.js"><link rel="prefetch" href="/assets/js/40.62213aa6.js"><link rel="prefetch" href="/assets/js/41.49b9b23a.js"><link rel="prefetch" href="/assets/js/42.22636733.js"><link rel="prefetch" href="/assets/js/43.d701984b.js"><link rel="prefetch" href="/assets/js/44.2e400124.js"><link rel="prefetch" href="/assets/js/45.0624d1de.js"><link rel="prefetch" href="/assets/js/46.745f744e.js"><link rel="prefetch" href="/assets/js/47.9f6c8d80.js"><link rel="prefetch" href="/assets/js/48.d4839beb.js"><link rel="prefetch" href="/assets/js/49.611156b4.js"><link rel="prefetch" href="/assets/js/5.0ad437e1.js"><link rel="prefetch" href="/assets/js/50.6e8a838a.js"><link rel="prefetch" href="/assets/js/51.92310adf.js"><link rel="prefetch" href="/assets/js/52.9119f7ec.js"><link rel="prefetch" href="/assets/js/53.b0ecb015.js"><link rel="prefetch" href="/assets/js/54.ae3f0c7c.js"><link rel="prefetch" href="/assets/js/55.33e52bf4.js"><link rel="prefetch" href="/assets/js/56.4095a95a.js"><link rel="prefetch" href="/assets/js/57.82f7ecdc.js"><link rel="prefetch" href="/assets/js/58.e962ac35.js"><link rel="prefetch" href="/assets/js/59.8176812c.js"><link rel="prefetch" href="/assets/js/6.a4dfda94.js"><link rel="prefetch" href="/assets/js/60.134675a4.js"><link rel="prefetch" href="/assets/js/61.1694e58c.js"><link rel="prefetch" href="/assets/js/62.05ef2169.js"><link rel="prefetch" href="/assets/js/7.88958cff.js"><link rel="prefetch" href="/assets/js/8.520103ae.js"><link rel="prefetch" href="/assets/js/9.5c4ee0d0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a8c216e1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Guangyuan's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/前端基础/" class="nav-link">
  FE-前端
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/前端基础/" class="nav-link">
  FE-前端
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/前端基础/JavaScript基础/01-JavaScript数据类型及其相关问题.html" class="sidebar-link">01-JavaScript数据类型及其相关问题</a></li><li><a href="/前端基础/JavaScript基础/02-数据拷贝.html" class="sidebar-link">02-数据拷贝</a></li><li><a href="/前端基础/JavaScript基础/03-原型链和继承.html" class="sidebar-link">03-原型链和继承</a></li><li><a href="/前端基础/JavaScript基础/04-JavaScript执行过程.html" class="sidebar-link">04-JavaScript执行过程</a></li><li><a href="/前端基础/JavaScript基础/05-this指向.html" class="sidebar-link">05-this指向</a></li><li><a href="/前端基础/JavaScript基础/06-闭包.html" class="sidebar-link">06-闭包</a></li><li><a href="/前端基础/JavaScript基础/07-函数的柯里化.html" class="sidebar-link">07-函数的柯里化</a></li><li><a href="/前端基础/JavaScript基础/08-深入数组.html" class="sidebar-link">08-深入数组</a></li><li><a href="/前端基础/JavaScript基础/09-Promise.html" class="sidebar-link">09-Promise</a></li><li><a href="/前端基础/JavaScript基础/10-aync&amp;await.html" class="sidebar-link">10-aync&amp;await</a></li><li><a href="/前端基础/JavaScript基础/11-eventLoop.html" class="active sidebar-link">11-eventloop</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/前端基础/JavaScript基础/12-js模块化.html" class="sidebar-link">12-js的模块化</a></li><li><a href="/前端基础/JavaScript基础/13-防抖和节流.html" class="sidebar-link">13-防抖和节流</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>认知</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>web安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法和数据结构</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><strong>什么是宏任务与微任务？</strong></p> <p>为了提高CPU的利用效率：Js 有两种任务的执行模式：<strong>同步模式（Synchronous）和异步模式（Asynchronous）</strong>。</p> <p>在异步模式下，创建<strong>异步任务主要分为宏任务与微任务两种</strong>。</p> <ul><li>ES6 规范中，宏任务（Macrotask） 称为 Task， 微任务（Microtask） 称为 Jobs。宏任务是由宿主（浏览器、Node）发起的</li> <li>微任务由 JS 自身发起。</li></ul> <p><strong>宏任务与微任务的几种创建方式</strong> 👇</p> <table><thead><tr><th><strong>宏任务（<strong><strong>Macrotask</strong></strong>）</strong></th> <th><strong>微任务（<strong><strong>Microtask</strong></strong>）</strong></th></tr></thead> <tbody><tr><td>setTimeout</td> <td>requestAnimationFrame（有争议）</td></tr> <tr><td>setInterval</td> <td>MutationObserver（浏览器环境）</td></tr> <tr><td>MessageChannel</td> <td>Promise.[ then/catch/finally ]</td></tr> <tr><td>I/O，事件队列</td> <td>process.nextTick（Node环境）</td></tr> <tr><td>setImmediate（Node环境）</td> <td>queueMicrotask</td></tr> <tr><td>script（整体代码块）</td> <td></td></tr></tbody></table> <p><strong>如何理解 script（整体代码块）是个宏任务呢</strong> 🤔</p> <p>实际上如果同时存在两个 script 代码块，会首先在执行第一个 script 代码块中的同步代码，如果这个过程中创建了微任务并进入了微任务队列，第一个 script 同步代码执行完之后，会首先去清空微任务队列，再去开启第二个 script 代码块的执行。所以这里应该就可以理解 script（整体代码块）为什么会是宏任务。</p> <p><strong>什么是 EventLoop ？</strong></p> <p>先来看个图</p> <p><img src="/assets/img/event-loop.2ff254cb.png" alt="image-20211107112127951"></p> <p>（细节在宏任务和微任务是否为空的建投指向）</p> <ol><li><p>判断宏任务队列是否为空</p></li> <li><ul><li>不空 --&gt; 执行最早进入队列的任务 --&gt; 执行下一步</li> <li>空 --&gt; 执行下一步</li></ul></li> <li><p>判断微任务队列是否为空</p></li> <li><ul><li>不空 --&gt; 执行最早进入队列的任务 --&gt; <strong>继续检查微任务队列空不空</strong></li> <li>空 --&gt; 执行下一步</li></ul></li></ol> <p>因为首次执行宏队列中会有 script（整体代码块）任务，所以实际上就是 **Js 解析完成后，在异步任务中，会先执行完所有的微任务，**这里也是很多面试题喜欢考察的。需要注意的是，新创建的微任务会立即进入微任务队列排队执行，不需要等待下一次轮回???</p> <p><strong>同步代码立即执行，微任务宏任务都要进入对应的队列排队</strong></p> <ol><li>渲染事件</li> <li>用户交互事件</li> <li>js脚本执行 （script加载）</li> <li>网络请求，文件读写完成事件</li> <li>延时任务 （setTimoue/setInterval）</li></ol> <p>其实引入微任务的初衷是为了解决异步回调的问题。想一想，对于异步回调的处理，有多少种方式？总结起来有两点:
将异步回调进行宏任务队列的入队操作。
将异步回调放到当前宏任务的末尾。</p> <p>如果采用第一种方式，那么执行回调的时机应该是在前面所有的宏任务完成之后，倘若现在的任务队列非常长，那么回调迟迟得不到执行，造成应用卡顿。
为了规避这样的问题，</p> <h3 id="浏览器执行宏任务和微任务的过程"><a href="#浏览器执行宏任务和微任务的过程" class="header-anchor">#</a> 浏览器执行宏任务和微任务的过程</h3> <ol><li>一开始整段脚本作为第一个宏任务执行 (script)</li> <li>执行过程中同步代码直接执行，宏任务进入宏任务队列，微任务进入微任务队列</li> <li>当前宏任务执行完出队，检查微任务队列，如果有则依次执行，直到微任务队列为空</li> <li>执行浏览器 UI 线程的渲染工作</li> <li>检查是否有Web worker任务，有则执行</li> <li>执行队首新的宏任务，回到2，依此循环，直到宏任务和微任务队列都为空</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/前端基础/JavaScript基础/10-aync&amp;await.html" class="prev">
        10-aync&amp;await
      </a></span> <span class="next"><a href="/前端基础/JavaScript基础/12-js模块化.html">
        12-js的模块化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.220ea92e.js" defer></script><script src="/assets/js/2.704b5ff1.js" defer></script><script src="/assets/js/13.7eef8f89.js" defer></script>
  </body>
</html>
